# dela - Система управления сотрудниками

Современная система управления сотрудниками с ролевым доступом, инвентаризацией и документооборотом.

## Возможности

- **Управление сотрудниками**: добавление, редактирование, архивирование
- **Департаменты**: организация по отделам
- **Инвентаризация**: учет оборудования
- **Excel импорт/экспорт**: обмен данными через таблицы
- **Ролевая система**: Admin, System Admin, Accountant
- **Печать документов**: акты, обходные листы
- **Карточки сотрудников**: полная информация

## Технологии

- **Frontend**: React 18 + TypeScript + Vite + Tailwind CSS
- **Backend**: Node.js + Express.js + TypeScript + Drizzle ORM
- **База данных**: PostgreSQL
- **Управление процессами**: PM2

## Быстрое развертывание

### 1. Установка зависимостей
```bash
npm install
```

### 2. Настройка базы данных
Создайте файл `.env`:
```env
DATABASE_URL=postgresql://username:password@localhost:5432/database_name
SESSION_SECRET=your_secure_session_secret_min_32_chars
PORT=5000
NODE_ENV=production
```

### 3. Инициализация базы данных
```bash
npm run db:generate
npm run db:migrate
```

### 4. Сборка приложения
```bash
npm run build
```

### 5. Запуск через PM2
```bash
# Установка PM2 (если не установлен)
npm install -g pm2

# Запуск приложения
npm run pm2:start

# Полезные команды PM2
npm run pm2:logs     # Просмотр логов
npm run pm2:restart  # Перезапуск
npm run pm2:stop     # Остановка
```

## Разработка

### Запуск в режиме разработки
```bash
npm run dev
```

Приложение будет доступно по адресу: `http://localhost:5000`

### Пользователь по умолчанию
- **Email**: admin@admin.com
- **Пароль**: POik09MN!

**Обязательно смените пароль после первого входа!**

## Структура проекта

```
dela/
├── client/           # React фронтенд
├── server/           # Express бэкенд
├── shared/           # Общие типы и схемы
├── deploy/           # Скрипты развертывания
└── drizzle/          # Миграции базы данных
```

## Управление базой данных

```bash
# Создание миграции
npm run db:generate

# Применение миграций
npm run db:migrate

# Просмотр схемы (в разработке)
npx drizzle-kit studio
```

## Мониторинг

```bash
# Статус PM2
pm2 status

# Логи в реальном времени
pm2 logs dela --lines 50

# Мониторинг ресурсов
pm2 monit
```

## Автозапуск

```bash
# Сохранение текущей конфигурации PM2
pm2 save

# Настройка автозапуска при перезагрузке системы
pm2 startup
```

## Резервное копирование

### База данных
```bash
# Создание бэкапа
pg_dump -h localhost -U username -d database_name > backup.sql

# Восстановление
psql -h localhost -U username -d database_name < backup.sql
```

### Автоматическое резервное копирование
Добавьте в crontab:
```bash
# Ежедневно в 2:00
0 2 * * * pg_dump -h localhost -U username -d database_name > /backups/dela_$(date +\%Y\%m\%d).sql
```

## Обновление приложения

```bash
# Остановка
npm run pm2:stop

# Получение изменений (если используете git)
git pull

# Установка зависимостей
npm install

# Сборка
npm run build

# Миграции (если есть новые)
npm run db:migrate

# Запуск
npm run pm2:start
```

## Устранение неполадок

### Проверка статуса
```bash
pm2 status          # Статус процессов
pm2 logs dela       # Логи приложения
netstat -tlnp | grep 5000  # Проверка порта
```

### Перезапуск всех сервисов
```bash
pm2 restart dela
# или полный перезапуск PM2
pm2 restart all
```

### Очистка логов
```bash
pm2 flush dela      # Очистка логов
```

## Производство

Для продакшена рекомендуется:

1. **Настроить nginx как reverse proxy**
2. **Использовать HTTPS с SSL сертификатами**
3. **Настроить firewall**
4. **Регулярные резервные копии**
5. **Мониторинг ресурсов системы**

## Безопасность

- Используйте сильные пароли для базы данных
- Настройте SESSION_SECRET как случайную строку минимум 32 символа
- Регулярно обновляйте зависимости: `npm audit fix`
- Ограничьте доступ к серверу через firewall

## Поддержка

При возникновении проблем:
1. Проверьте логи: `npm run pm2:logs`
2. Проверьте статус: `pm2 status`
3. Убедитесь, что база данных доступна
4. Проверьте переменные окружения в `.env`

---

**Лицензия**: MIT